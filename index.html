<script>
  const API_KEY = "AIzaSyCgSMNXRR6009aHCYCWryZrpB9cgx3-yp8"; // ðŸ”‘ Replace with your Gemini API key

  const chatbox = document.getElementById("chatbox");
  const chatToggle = document.getElementById("chatToggle");
  const sendButton = document.getElementById("sendButton");
  const userInput = document.getElementById("userInput");
  const chatMessages = document.getElementById("chatbox-messages");

  chatToggle.addEventListener("click", () => {
    chatbox.style.display = chatbox.style.display === "none" ? "flex" : "none";
  });

  sendButton.addEventListener("click", sendMessage);
  userInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
  });

  async function sendMessage() {
    const userText = userInput.value.trim();
    if (!userText) return;

    addMessage(userText, "user-message");
    userInput.value = "";

    const loadingMsg = addMessage("Typing...", "bot-message");

    try {
      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [
              {
                role: "user",
                parts: [
                  {
                    text: `You are Bougainvillea House Assistant. Refer to https://www.bougainvilleahouse.in/ for details and answer helpfully.\nUser question: ${userText}`
                  }
                ]
              }
            ]
          })
        }
      );

      const data = await response.json();
      console.log("Gemini API response:", data);

      chatMessages.removeChild(loadingMsg);

      const botReply = data?.candidates?.[0]?.content?.parts?.[0]?.text;
      if (botReply) {
        addMessage(botReply, "bot-message");
      } else if (data.error) {
        addMessage("Error: " + data.error.message, "bot-message");
      } else {
        addMessage("Sorry, I couldn't find an answer.", "bot-message");
      }
    } catch (error) {
      console.error("Fetch error:", error);
      chatMessages.removeChild(loadingMsg);
      addMessage("Error connecting to Gemini API.", "bot-message");
    }
  }

  function addMessage(text, className) {
    const msg = document.createElement("div");
    msg.className = className;
    msg.textContent = text;
    chatMessages.appendChild(msg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    return msg;
  }
</script>
